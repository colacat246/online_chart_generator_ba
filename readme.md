# readme

## 数据库结构

### 查图形数据流程

* user表放用户
* graphs_meta表放每种图形的一些整体配置
* user2graph_map建立用户和所创建图形之间的映射
* 通过所创建图形的id和种类查询对应的表，找到数据集、数据集配置、图配置

### 配置文件存储

使用JSON数据类型，降低表设计复杂度，且方便后期修改

## 接口文档

### 注册

请求地址：`/api/register`
请求方法：post

请求参数：

| 字段       | 说明  | 类型     | 备注 | 是否必填 |
|----------|-----|--------|----|------|
| userName | 用户名 | String |    | 是    |
| password | 密码  | String |    | 是    |

返回参数：

| 字段              | 说明              | 类型     | 备注                         | 是否必填                                                                  |
|-----------------|-----------------|--------|----------------------------|-----------------------------------------------------------------------|
| statusCode      | 接口状态码           | Number | 成功：999；空参数：1000； 验证失败：1001 | 是                                                                     |
| message         | 接口信息            | String | 成功：'success' 失败：提示信息       | 是                                                                     |
| userVo          | 用户数据，包括用户id和用户名 | Object | 是                          |                                                                       |
| user-auth-token | JWT Token       | String | 是                          | 有用户ID userId: Number、用户名 userName: String、过期时间 exp: Number，cookie形式获取 |

### 登录

请求地址：`/api/login`
请求方法：post

请求参数：

| 字段       | 说明  | 类型     | 备注 | 是否必填 |
|----------|-----|--------|----|------|
| userName | 用户名 | String |    | 是    |
| password | 密码  | String |    | 是    |

返回参数：

| 字段              | 说明              | 类型     | 备注                         | 是否必填                                                                  |
|-----------------|-----------------|--------|----------------------------|-----------------------------------------------------------------------|
| statusCode      | 接口状态码           | Number | 成功：999；空参数：1000； 验证失败：1001 | 是                                                                     |
| message         | 接口信息            | String | 成功：'success' 失败：提示信息       | 是                                                                     |
| userVo          | 用户数据，包括用户id和用户名 | Object | 是                          |                                                                       |
| user-auth-token | JWT Token       | String | 是                          | 有用户ID userId: Number、用户名 userName: String、过期时间 exp: Number，cookie形式获取 |

### 请求侧边栏

请求地址：`/api/userGraphList`
请求方法：get

请求Cookie：

| 字段              | 说明        | 类型     | 备注                        | 是否必填 |
|-----------------|-----------|--------|---------------------------|------|
| user-auth-token | 用户验证Jwt数据 | String | header中x-www-auth-token携带 | 是    |

请求参数：无

返回参数：

| 字段         | 说明    | 类型              | 备注                          | 是否必填 |
|------------|-------|-----------------|-----------------------------|------|
| statusCode | 接口状态码 | Number          | 成功：999；失败：{1000, 1001, 1002 | 是    |
| message    | 接口信息  | String          | 成功：'OK' 失败：提示信息             | 是    |
| asideList  | 数据    | list<asideItem> |                             | 是    |

asideItem:

| 字段             | 说明    | 类型     | 备注                      | 是否必填 |
|----------------|-------|--------|-------------------------|------|
| createdGraphId | 序号    | Number |                         | 是    |
| graphName      | 图形名称  | String |                         | 是    |
| createdTime    | 创建时间  | String | yyyy-MM-dd HH:mm:ss:SSS | 是    |
| graphTypeId    | 图形的种类 | Number | 这个种类设置在前端配置中            | 是    |

### 请求图数据

请求地址：`/api/userGraph/{createdGraphId}`
请求方法：get

请求参数：

| 字段             | 说明  | 类型     | 备注 | 是否必填 |
|----------------|-----|--------|----|------|
| createdGraphId | 图id | Number |    | 是    |

返回参数：

| 字段         | 说明    | 类型     | 备注                   | 是否必填 |
|------------|-------|--------|----------------------|------|
| statusCode | 接口状态码 | Number | 成功：200；失败：404        | 是    |
| message    | 接口信息  | String | 成功：'success' 失败：提示信息 | 是    |
| data       | 图数据   | json   |                      |      |

### TODO 新建图形

请求地址：`/api/userGraph/`
请求方法：post

请求参数：

| 字段          | 说明     | 类型     | 备注 | 是否必填 |
|-------------|--------|--------|----|------|
| graphTypeId | 图类型的id | Number |    | 是    |
| graphName   | 图名称    | String |    | 是    |

返回参数：

| 字段         | 说明    | 类型     | 备注                   | 是否必填 |
|------------|-------|--------|----------------------|------|
| statusCode | 接口状态码 | Number | 成功：200；失败：404        | 是    |
| message    | 接口信息  | String | 成功：'success' 失败：提示信息 | 是    |
| data       | 数据    | json   | 返回graphList          |      |

data字段：

| 字段         | 说明      | 类型      | 备注 | 是否必填 |
|------------|---------|---------|----|------|
| graphList  | 更新后的图列表 | Array   |    | 是    |
| newGraphId | 新图形的Id  | Integer |    |      |

### TODO 新建series

请求地址：`/api/userGraphSeries/`
请求方法：post

请求参数：

| 字段             | 说明       | 类型     | 备注 | 是否必填 |
|----------------|----------|--------|----|------|
| createdGraphId | 曲线所属图的id | Number |    | 是    |
| seriesName     | 曲线名称     | String |    | 是    |

返回参数：

| 字段         | 说明    | 类型     | 备注                   | 是否必填 |
|------------|-------|--------|----------------------|------|
| statusCode | 接口状态码 | Number | 成功：200；失败：404        | 是    |
| message    | 接口信息  | String | 成功：'success' 失败：提示信息 | 是    |
| data       | 新数据   | json   | 返回graphList          |      |

data字段：

| 字段          | 说明      | 类型      | 备注 | 是否必填 |
|-------------|---------|---------|----|------|
| graph       | 更新后的图数据 | json    |    | 是    |
| newSeriesId | 新曲线的Id  | Integer |    |      |

### TODO 删除图形

请求地址：`/api/userGraph/`
请求方法：delete

请求参数：

| 字段             | 说明     | 类型     | 备注 | 是否必填 |
|----------------|--------|--------|----|------|
| createdGraphId | 图类型的id | Number |    | 是    |

返回参数：

| 字段         | 说明    | 类型     | 备注                   | 是否必填 |
|------------|-------|--------|----------------------|------|
| statusCode | 接口状态码 | Number | 成功：200；失败：404        | 是    |
| message    | 接口信息  | String | 成功：'success' 失败：提示信息 | 是    |
| data       | 数据    | json   | 返回graphList          |      |

data字段：

| 字段         | 说明           | 类型      | 备注           | 是否必填 |
|------------|--------------|---------|--------------|------|
| graphList  | 更新后的图列表      | json    |              | 是    |
| curGraphId | 更新后所跳转到的图形ID | Integer | 图列表为空时返回null |      |

### TODO 更新图形

* 前端设置更新按钮，或轮询？

### TODO 删除曲线

### TODO 更新曲线

同删除 / 更新图形

### template

请求地址：`/api/path`
请求方法：get

请求参数：

| 字段     | 说明 | 类型 | 备注 | 是否必填 |
|--------|----|----|----|------|
| field1 |    |    |    |      |
| field2 |    |    |    |      |

返回参数：

| 字段         | 说明    | 类型     | 备注                   | 是否必填 |
|------------|-------|--------|----------------------|------|
| statusCode | 接口状态码 | Number | 成功：200；失败：404        | 是    |
| message    | 接口信息  | String | 成功：'success' 失败：提示信息 | 是    |
| data       | 数据    | json   |                      |      |
| field1     |       |        |                      |      |
| field2     |       |        |                      |      |

data:

| 字段   | 说明 | 类型     | 备注 | 是否必填 |
|------|----|--------|----|------|
| page | 页号 | Number |    | 是    |
| size | 大小 | Number |    | 是    |

## TODO

定义折线图数据库，通过用户jwt，图形id获取图形，使用json储存图形配置，建立数据库模型

* 注册用户名提前验证
* 使用validator[校验配置文件](https://blog.csdn.net/jianzhang11/article/details/108332727)，检查是否有jwt私钥
* 使用validator检查请求参数、请求体等数据，配合注解`@Validated` `@Notblank`等使用
* 通过注解确定是否使用登录拦截器，拦截器中通过handler可以拿到方法，进而拿到注解
* mybatis通过typeHandler处理数据库中的json数据
* springboot使用全参数构造函数之后省略`@Autowired`
* Bean提到初始化时赋值
* 集中处理异常
* 调整cookie过期时间
* 处理jwt过期问题
* 配置测试和开发使用不同数据库